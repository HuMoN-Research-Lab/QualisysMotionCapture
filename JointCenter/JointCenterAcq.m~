%% Master Script for Joint Center Calc for individual trials
clc
clear all
close all
if ispc %JSM PC
    code_path = 'C:\Users\jonma\Dropbox\ResearchProjects\GithubDesktop_DontEdit\COMPhaseSpacePlanning';
    data_path = 'C:\Users\jonma\Google Drive\MotionCaptureProjects\Qualisys_MotionCapture\RevisedWalkingData';
elseif ismac %MT Mac
    code_path = '/Users/MT/Documents/GitHub/QualisysMotionCapture';
    data_path = '/Users/MT/Google Drive File Stream/My Drive/MotionCaptureProjects/Qualisys_MotionCapture/RevisedWalkingData'; %/Qualisys_MotionCapture'
end

cd(code_path)
addpath(genpath(cd))
addpath(data_path)

%% Load acquired Qualisys MoCap Data
[skeleton] = import_tsv_file(skeleton_file);
skeleton_file = fullfile(data_path,'2020-03-04_JSM_TPose_s_Jon.tsv');
fid = fopen(skeleton_file);
C = textscan(fid,['%s' repmat('%s',1,178)], 'HeaderLines', 5); %178
fclose(fid);
skeleton_data = C{1,1};
skeleton_data(:,2) = C{1,2};
hips = C{1,3};
% hips = erase(hips,'Hips');
hips(:,2) = C{1,4};
hips(:,3) = C{1,5};
hips(:,4) = C{1,6};
hips(:,5) = C{1,7};
hips(:,6) = C{1,8};
% hips(1,1:5) = hips(1,2:6);
hips = str2num(cell2mat(hips));
% tsv_skeleton_file = '2020-03-04_JSM_TPose_s_Jon';
file_name = '02_21_2020_Walking_Calibration';
% fileName = '2020-03-04_JSM_TPose';
load('externalData.mat');
[markerLabels,marker_mar_dim_frame,Force] = loadMoCapData(file_name);

%% Index markers and segCenters using MoCap data
[segCenter] = indexMars_Segs(marker_mar_dim_frame,markerLabels,trial_start_end);

%% Function optimizes joint center location
[jointCenters] = jointCenterOpt(segCenter);
